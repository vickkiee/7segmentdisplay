     1: /* Main.c file generated by New Project wizard
     2:  * Created by Victoria Oguntosin
     3:  * Created:   Tue May 16 2017
     4:  * Processor: PIC16F876A
     5:  * Compiler:  HI-TECH C for PIC10/12/16
     6:  */
     7: 
     8: #ifndef _XTAL_FREQ
     9:         // Unless already defined assume 4MHz system frequency
    10:         // This definition is required to calibrate __delay_us() and __delay_ms()
    11:         #define _XTAL_FREQ 4000000L // 4MHz
    12: #endif
    13: 
    14: #include <htc.h>
    15: 
    16: // set chip configuration bits  
    17: __CONFIG(FOSC_XT & WDTE_OFF & PWRTE_OFF & BOREN_OFF & LVP_OFF & WRT_OFF & DEBUG_OFF & CPD_OFF & CP_OFF);
    18: 
    19: void interrupt TMR0INT(void);
    20: void LED_DISPLAY(void);
    21: 
    22: unsigned char DIS_NUM[4];
    23: unsigned char TMR2_COUNTER;
    24: unsigned int counter;
    25: 
    26: // Common Anode display
    27: unsigned char LED_DIS[] = {0xc0,0xf9,0xa4,0xb0,0x99,0x92,0x82,0xf8,0x80,0x90,0X88,0X83,0XC6,0XA1,0X86,0X8E,0XFF};
    28: 
    29: void main(void) {
    30:         TRISB = 0x00; // Set RB0-7 as outputs
    31:         TRISC = 0x00; // Set RC0-7 as outputs
    32:         TRISA = 0b00000000; // Set RA0-5 as outputs
    33:         ADCON1 = 0b0110; // turn all of PORTA to digital I/O
    34:         
    35:         OPTION_REG = 0x07;      // 1:256 prescaler
    36:         INTCON = 0xa0;  //GIE = 1; TMR0IE = 1 ; enable all unmaked interrupts, enable TMR0 interrupt
    37:         TMR0 = 0x3d;    // 50ms period
    38:         counter = 0;
    39:         while(1) {     
    40:                 DIS_NUM[0] = (unsigned char)(counter/1000);
    41:                 DIS_NUM[1] = (unsigned char)((counter%1000)/100);
    42:                 DIS_NUM[2] = (unsigned char)((counter%100)/10);
    43:                 DIS_NUM[3] = (unsigned char)(counter%10);
    44:                 LED_DISPLAY();
    45:         }
    46: }
    47:  
    48: void interrupt TMR0INT(void) {
    49:         TMR0IF = 0;     // clear overflow flag bit when the interrupt occurs
    50:         TMR2_COUNTER++;
    51:         RA0 = !RA0;
    52:         if(TMR2_COUNTER == 2){
    53:                 RA2 = !RA2;
    54:                 TMR2_COUNTER = 0;
    55:                 counter++;              
    56:         }
    57:         TMR0 = 0x3c;    // 50ms period
    58: }       
    59: 
    60: void LED_DISPLAY(void) {
    61:         unsigned char i, TEMP;
    62:         TEMP = 0x01;    //0b0000 0001   0b0000 0010   0b0000 0100    0b0000 1000
    63:         for(i=0; i<4; i++) {                                     
    64:                 PORTC = TEMP;                 
    65:                 PORTB = LED_DIS[DIS_NUM[i]];
    66:                 TEMP <<= 1; 
    67:                 __delay_us(200);
    68:         }
    69: }
